<template>
  <div id="comment-page">
    <section class="title-logo">
      <svg
        width="220"
        height="73"
        viewBox="0 0 220 73"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M218 36.5C218 40.6602 215.461 44.9451 210.121 49.1339C204.805 53.3042 196.989 57.147 187.152 60.4112C167.499 66.9324 140.221 71 110 71C79.7787 71 52.5013 66.9324 32.8481 60.4112C23.011 57.147 15.1946 53.3042 9.87881 49.1339C4.53941 44.9451 2 40.6602 2 36.5C2 32.3398 4.53941 28.0549 9.87881 23.8661C15.1946 19.6958 23.011 15.853 32.8481 12.5888C52.5013 6.06756 79.7787 2 110 2C140.221 2 167.499 6.06756 187.152 12.5888C196.989 15.853 204.805 19.6958 210.121 23.8661C215.461 28.0549 218 32.3398 218 36.5Z"
          fill="white"
          fill-opacity="0.12"
          stroke="#572A00"
          stroke-width="4"
        />
        <path
          d="M40.3869 24.7443C43.2429 24.7443 45.5015 25.4629 47.1629 26.9003C48.8242 28.3189 49.6549 30.3536 49.6549 33.0043H43.7469C43.7469 31.8843 43.4482 30.9976 42.8509 30.3443C42.2722 29.6909 41.4415 29.3643 40.3589 29.3643C39.1082 29.3643 38.1842 29.7563 37.5869 30.5403C37.0082 31.3243 36.7189 32.4163 36.7189 33.8163V35.6083C36.7189 36.9896 37.0082 38.0816 37.5869 38.8843C38.1842 39.6683 39.0895 40.0603 40.3029 40.0603C41.4975 40.0603 42.4029 39.7523 43.0189 39.1363C43.6349 38.5203 43.9429 37.6523 43.9429 36.5323H49.6549C49.6549 39.1643 48.8429 41.1803 47.2189 42.5803C45.6135 43.9803 43.3362 44.6803 40.3869 44.6803C37.1015 44.6803 34.6095 43.8403 32.9109 42.1603C31.2309 40.4803 30.3909 37.9976 30.3909 34.7123C30.3909 31.4269 31.2309 28.9443 32.9109 27.2643C34.6095 25.5843 37.1015 24.7443 40.3869 24.7443ZM62.5718 24.7443C65.8945 24.7443 68.4612 25.5936 70.2718 27.2923C72.0825 28.9909 72.9878 31.4643 72.9878 34.7123C72.9878 37.9603 72.0825 40.4336 70.2718 42.1323C68.4612 43.8309 65.8945 44.6803 62.5718 44.6803C59.2492 44.6803 56.6825 43.8403 54.8718 42.1603C53.0798 40.4616 52.1838 37.9789 52.1838 34.7123C52.1838 31.4456 53.0798 28.9723 54.8718 27.2923C56.6825 25.5936 59.2492 24.7443 62.5718 24.7443ZM62.5718 29.3643C61.2465 29.3643 60.2385 29.7656 59.5478 30.5683C58.8572 31.3709 58.5118 32.4536 58.5118 33.8163V35.6083C58.5118 36.9709 58.8572 38.0536 59.5478 38.8563C60.2385 39.6589 61.2465 40.0603 62.5718 40.0603C63.8972 40.0603 64.9052 39.6589 65.5958 38.8563C66.3052 38.0536 66.6598 36.9709 66.6598 35.6083V33.8163C66.6598 32.4536 66.3052 31.3709 65.5958 30.5683C64.9052 29.7656 63.8972 29.3643 62.5718 29.3643ZM92.868 44.3443V37.4003C92.868 36.5416 92.896 35.6643 92.952 34.7683C93.0267 33.8536 93.1014 33.0883 93.176 32.4723C93.2507 31.8563 93.2974 31.4643 93.316 31.2963H93.204L89.648 44.3443H84.804L81.22 31.3243H81.108C81.1267 31.4923 81.1734 31.8843 81.248 32.5003C81.3414 33.0976 81.4254 33.8536 81.5 34.7683C81.5747 35.6643 81.612 36.5416 81.612 37.4003V44.3443H75.928V25.0803H84.664L87.576 36.1963H87.688L90.572 25.0803H99V44.3443H92.868ZM119.309 44.3443V37.4003C119.309 36.5416 119.337 35.6643 119.393 34.7683C119.468 33.8536 119.543 33.0883 119.617 32.4723C119.692 31.8563 119.739 31.4643 119.757 31.2963H119.645L116.089 44.3443H111.245L107.661 31.3243H107.549C107.568 31.4923 107.615 31.8843 107.689 32.5003C107.783 33.0976 107.867 33.8536 107.941 34.7683C108.016 35.6643 108.053 36.5416 108.053 37.4003V44.3443H102.369V25.0803H111.105L114.017 36.1963H114.129L117.013 25.0803H125.441V44.3443H119.309ZM129.203 25.0803H145.863V29.7003H135.391V32.3603H144.351V36.7843H135.391V39.7243H146.059V44.3443H129.203V25.0803ZM163.186 44.3443L155.094 34.9923V44.3443H149.41V25.0803H154.814L162.906 34.5723V25.0803H168.59V44.3443H163.186ZM183.822 30.0083V44.3443H177.634V30.0083H171.306V25.0803H190.122V30.0083H183.822Z"
          fill="#572A00"
        />
      </svg>
    </section>
    <div class="divider" />
    <article class="comment-input-group">
      <p class="comment-input__name">
        <input id="name" v-model="comment.title" type="text" placeholder="👤 이름" />
      </p>
      <p class="comment-input__contents">
        <textarea
          id="contents"
          v-model="comment.body"
          type="text"
          placeholder="💌 재의와 영규에게 축하의 메세지를 입력해주세요"
        />
      </p>
      <button v-if="!saveLoading" class="save-btn" @click="addComments">Add</button>
      <button v-else disabled class="save-btn" @click="addComments">Add</button>
    </article>
    <b-pagination
      v-model="currentPage"
      :total-rows="rows"
      :per-page="perPage"
      aria-controls="my-table"
      first-text="«"
      prev-text="‹"
      next-text="›"
      last-text="»"
      pills
      size="sm"
    ></b-pagination>
    <div>
      <article class="comments" v-for="(data, idx) in currentComments" :key="idx">
        <section class="comment-title">
          <h1 class="comment-title__name">{{ data.title }}</h1>
          <h5 class="comment-title__date">{{ getDate(data.created_at) }}</h5>
        </section>
        <section class="comment-body">
          {{ data.body }}
        </section>
      </article>
    </div>
  </div>
</template>
<script lang="ts">
import { Component, Vue } from 'vue-property-decorator';
import axios from 'axios';
import moment from 'moment';
type Comment = { title: string; body: string };

@Component({})
export default class CommentPage extends Vue {
  token1 = 'ghp_vPA2';
  token2 = 'wsu2855tj';
  token3 = 'JP9diunwQc';
  token4 = 'ib219jO0mtU9p';
  API_BASE_URL = 'https://api.github.com/repos/wedding-09-2j/wedding-09-2j.github.io/issues';
  res: Comment[] = [];
  comment: Comment = {
    title: '',
    body: '',
  };
  perPage = 5;
  currentPage = 1;
  saveLoading = false;
  get currentComments() {
    return this.res.slice((this.currentPage - 1) * this.perPage, this.perPage * this.currentPage);
  }
  get rows() {
    return this.res.length;
  }
  get totalPage() {
    return Math.ceil(this.res.length / 5);
  }
  created() {
    this.loadComments();
  }
  getDate(date: string) {
    return moment(date).format('YYYY.MM.DD HH:mm');
  }
  loadComments() {
    axios
      .get(this.API_BASE_URL, {
        headers: {
          Authorization: `Bearer ${this.token1 + this.token2 + this.token3 + this.token4}`,
        },
      })
      .then(res => {
        this.res = res.data;
      });
  }

  addComments() {
    const requestBody = { title: this.comment.title, body: this.comment.body };
    this.saveLoading = true;
    axios
      .post(this.API_BASE_URL, requestBody, {
        headers: {
          Authorization: `Bearer ${this.token1 + this.token2 + this.token3 + this.token4}`,
        },
      })
      .then(res => {
        console.log(res);
        this.res.unshift(requestBody);
      })
      .finally(() => {
        this.saveLoading = false;
      });
  }
}
</script>

<style lang="scss">
#comment-page {
  font-family: var(--bs-body-font-family);
}
.save-btn {
  width: fit-content;
  -webkit-align-self: flex-end !important; /* add prefixed version */
  -ms-flex-align: end;
  align-self: end;

  padding: 4px 11px;
  border-radius: 10px;
  border: none;
  background-color: cadetblue;
  color: white;
  font-weight: 500;
  font-size: 0.8em;
}
.save-btn:disabled {
  background-color: #5f9ea045;
}
.comment-input__name,
.comment-input__contents {
  text-align: start;
  margin: 5px 0;
  font-size: 0.8em;
  input,
  textarea {
    border: 1px solid #e2e2e2;
    border-radius: 5px;
    padding: 5px 10px;
  }
}

.comment-input-group {
  // background-color: #faf2f5;
  padding: 10px 20px;
  display: flex;
  display: -webkit-box;
  display: -webkit-flex;
  display: -webkit-flexbox;
  flex-direction: column;
}
#contents {
  width: 100%;
  height: 4em;
  resize: none;
}
.divider {
  margin-top: 30px;
}
.profile img {
  display: block;
  border-radius: 31px;
  width: 30px;
  height: 30px;
}
.comments {
  display: flex;
  flex-direction: column;
  align-items: start;
  padding: 10px 17px;
  background-color: #ede6d96b;
  margin: 5px 10px;
  border-radius: 10px;
}
.comment-title {
  display: flex;
  align-items: baseline;
  h1,
  h5 {
    margin: 0;
    padding: 5px 0;
  }
}
.comment-body {
  text-align: start;
  font-size: 0.8em;
}
.comment-title__name {
  font-size: 1em;
  margin-right: 5px !important;
}
.comment-title__date {
  font-size: 0.7em;
  color: #838383;
}
.pagination {
  justify-content: center;
  margin-top: 10px;
}
.page-item.active .page-link {
  color: #fff !important;
  background-color: #572a00 !important;
  border: none;
}
.page-link {
  color: #572a00 !important;
  border: none !important;
  background-color: #572a001c !important;
}
</style>
